<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operation Sentinel - System Status</title>
    <link rel="stylesheet" href="css/utils.css">
</head>
<body class="bg-gray-100 font-sans h-screen flex justify-center items-center m-0">
    <main class="bg-white p-8 rounded-lg shadow-lg max-w-md w-full text-center">
        <h1 class="text-2xl font-bold text-gray-800 m-0">Sentinel Status Board</h1>

        <div class="mt-4 p-4 rounded-lg bg-gray-100" role="status" aria-live="polite">
            <p class="text-gray-500">System Status</p>
            <p id="status-indicator" class="text-xl font-bold text-green-600">Checking...</p>
            <p id="threat-level" class="text-sm font-bold mt-4">THREAT: CHECKING</p>
        </div>

        <div class="mt-4 text-gray-500">
            <p>Directive: <span id="directive-display" class="font-bold">...</span></p>
            <p>Uptime: <span id="uptime-display">--</span>s</p>
            <button onclick="toggleCmd()" class="text-sm mt-4 text-gray-500 bg-white border-0" aria-label="Toggle Command Console">
                Security Protocol: Active
            </button>
        </div>

        <div id="cmd-console" class="hidden mt-4 bg-gray-100 p-4 rounded-lg">
            <input id="cmd-threat" placeholder="Threat Level" class="w-full p-4 mb-2 rounded-lg" aria-label="Set Threat Level">
            <input id="cmd-directive" placeholder="Directive" class="w-full p-4 mb-2 rounded-lg" aria-label="Set Directive">
            <button onclick="updateStatus()" class="w-full bg-white p-4 rounded-lg font-bold" aria-label="Update Status">UPDATE</button>
        </div>

        <div class="mt-4 text-left">
            <h2 class="text-sm font-bold text-gray-800">Active Assets</h2>
            <div id="asset-list" class="text-sm text-gray-500 mt-2 mb-4"></div>

            <h2 class="text-sm font-bold text-gray-800">Event Log</h2>
            <div id="event-log" class="text-sm text-gray-500 mt-2 h-32 overflow-y-auto"></div>
        </div>
    </main>

    <script>
        const statusEl = document.getElementById('status-indicator');
        const threatEl = document.getElementById('threat-level');
        const directiveEl = document.getElementById('directive-display');
        const uptimeEl = document.getElementById('uptime-display');
        const logEl = document.getElementById('event-log');
        const assetEl = document.getElementById('asset-list');

        function toggleCmd() {
            const el = document.getElementById('cmd-console');
            el.className = el.className.includes('hidden') ? 'block mt-4 bg-gray-100 p-4 rounded-lg' : 'hidden';
        }

        async function updateStatus() {
            const threat = document.getElementById('cmd-threat').value;
            const directive = document.getElementById('cmd-directive').value;
            if (!threat && !directive) return;

            await fetch('/api/tactical', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Auth-Token': 'SENTINEL-ALPHA'
                },
                body: JSON.stringify({
                    ...(threat && { threatLevel: threat.toUpperCase() }),
                    ...(directive && { directive: directive.toUpperCase() })
                })
            });
            fetchStatus();
        }

        async function fetchStatus() {
            try {
                const res = await fetch('/api/tactical');
                const data = await res.json();

                statusEl.textContent = data.status === 'operational' ? 'OPERATIONAL' : 'SYSTEM ALERT';
                statusEl.className = `text-xl font-bold ${data.status === 'operational' ? 'text-green-600' : 'text-red-600'}`;

                threatEl.textContent = `THREAT: ${data.threatLevel}`;
                threatEl.className = `text-sm font-bold mt-4 ${data.threatLevel === 'LOW' ? 'text-green-600' : (data.threatLevel === 'CRITICAL' ? 'text-red-600' : 'text-yellow-600')}`;

                directiveEl.textContent = data.directive;
                uptimeEl.textContent = Math.floor(data.uptime);

                if (data.logs) {
                    logEl.replaceChildren(...data.logs.slice(0, 5).map(l => {
                        const div = document.createElement('div');
                        const span = document.createElement('span');
                        span.className = 'font-bold text-xs';
                        span.textContent = `[${l.source}]`;
                        div.appendChild(span);
                        div.appendChild(document.createTextNode(' ' + l.action));
                        return div;
                    }));
                }

                if (data.assets) {
                    if (data.assets.length) {
                        assetEl.replaceChildren(...data.assets.map(a => {
                            const div = document.createElement('div');
                            div.className = 'flex justify-between';
                            const nameSpan = document.createElement('span');
                            nameSpan.textContent = a.name;
                            const typeSpan = document.createElement('span');
                            typeSpan.className = 'font-bold';
                            typeSpan.textContent = a.type || 'Unit';
                            div.appendChild(nameSpan);
                            div.appendChild(typeSpan);
                            return div;
                        }));
                    } else {
                        assetEl.textContent = 'No active assets';
                    }
                }
            } catch (e) {
                statusEl.textContent = 'CONNECTION LOST';
            }
        }

        fetchStatus();
        setInterval(fetchStatus, 2000);
    </script>
</body>
</html>
